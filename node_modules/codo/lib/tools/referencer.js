// Generated by CoffeeScript 1.6.3
(function() {
  var Tools;

  Tools = require('../_tools');

  module.exports = Tools.Referencer = (function() {
    function Referencer(environment) {
      this.environment = environment;
    }

    Referencer.prototype.resolve = function(text, replacer) {
      var _this = this;
      text = text.replace(/\`[^\`]*\`/mg, function(match) {
        return match.replace(/\{/mg, "\u0091").replace(/\}/mg, "\u0092");
      });
      text = text.replace(/\{([^\}]*)\}/gm, function(match, link) {
        var href, label, replacement;
        link = link.split(' ');
        href = link.shift();
        label = link.join(' ');
        replacement = _this.environment.reference(href);
        if (replacement !== href || /\:\/\/\w+((\:\d+)?\/\S*)?/.test(href)) {
          return replacer(replacement, label || href);
        } else {
          return match;
        }
      });
      return text = text.replace(/\`[^\`]*\`/mg, function(match) {
        return match.replace(/\u0091/mg, '{').replace(/\u0092/mg, '}');
      });
    };

    return Referencer;

  })();

}).call(this);
